<!-- ********* INPUT FROM DATE Collaborator https://github.com/leifermendez ***************** --->

<input (click)="openCalendar()" readonly spellcheck="false" class="omit-trigger-outside input-date-funny {{classInput}}"
       autocomplete="nope" [value]="value" [disabled]="isDisabled" (input)="onInput($event.target.value)" [ngClass]="{
    'date-picker-valid ng-valid': !isInvalid,
     'date-picker-invalid ng-invalid': isInvalid,
     'funny-range':includeEndDate,
     'ng-opened': isOpen,
     'ng-touched': onTouched,
     'ng-untouched': !onTouched
    }" type="text">

<!--- *************** CALENDAR ELEMENTS Author https://github.com/mokshithpyla ************* --->
<div (clickOutside)="closeCalendar()" class="calendar" *ngIf="isOpen">
  <!-- **** CALENDAR NAVIGATION ****-->
  <div class="calendar-nav">
    <div class="calendar-nav-previous-month">
      <button type="button" class="button is-text" (click)="changeNavMonth(-1)" [disabled]="!canAccessPrevious">
        <i class="fa fa-chevron-left"></i>
      </button>
    </div>
    <div>{{navDate.format('MMMM YYYY')}}</div>
    <div class="calendar-nav-next-month">
      <button type="button" class="button is-text" (click)="changeNavMonth(1)" [disabled]="!canAccessNext">
        <i class="fa fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!--- **** CALENDAR CONTAINER ****-->

  <div class="calendar-container">
    <div class="calendar-header">
      <div class="calendar-date" *ngFor="let day of weekDaysHeaderArr" [innerText]="day"></div>
    </div>
    <div class="calendar-body">
      <!---**** LOAD TEMPLATE*** --->
      <ng-container *ngTemplateOutlet="templateCalendar;context:{
      data:dataMonths,
      year:navDate.format('YYYY'),
      month:navDate.format('M'),
      includeEndDate:includeEndDate,
      startDay:null,
      endDate:null}"></ng-container>


    </div>


    <div class="footer-calendar">
      <div class="flex justify-content-between options-bar divider">
        <div class="flex">
          <div class="label-placeholder label-option pr-25">
            <input type="checkbox" [(ngModel)]="includeEndDate" (change)="handleModeChange()">
            <small>{{rangeLabel}}</small>
          </div>
          <div class="label-placeholder label-option pr-25">
            <input
              (change)="reFormatInput();handleTimeChange(startTime, startDate, 'start');handleTimeChange(endTime, endDate, 'end')"
              [(ngModel)]="includeTime" type="checkbox">
            <small>{{timeLabel}}</small>
          </div>
        </div>
        <div class="label-placeholder label-option pr-25">
          <div (click)="clear()">{{clearLabel}}</div>
        </div>
      </div>
      <div class="zone-preview-dates divider">
        <div class="child">
          <div class="calendar-child-day">{{startDate?.format('D')}}</div>
          <div>
            <div class="calendar-child-month">{{startDate?.format('MMMM YYYY')}}</div>
            <div class="calendar-child-week">{{startDate?.format('dddd')}}</div>
          </div>
        </div>
        <div class="child">
          <input #startTimePicker type="text" class="input-hour" autocomplete="nope" spellcheck="false"
                 [ngModel]="startDate.format('h:mm A')" *ngIf="startDate && includeTime"
                 (ngModelChange)="setStartTime($event)" (blur)="handleTimeChange(startTime, startDate, 'start')"
                 (keyup.enter)="handleTimeChange(startTime, startDate, 'start')">
        </div>
      </div>
      <div class="zone-preview-dates divider" *ngIf="includeEndDate">
        <div class="child">
          <div class="calendar-child-day">{{endDate?.format('D')}}</div>
          <div>
            <div class="calendar-child-month">{{endDate?.format('MMMM YYYY')}}</div>
            <div class="calendar-child-week">{{endDate?.format('dddd')}}</div>
          </div>
        </div>
        <div class="child">

          <ng-container *ngIf="endDate">
            <input #endTimePicker type="text" class="input-hour" autocomplete="nope" spellcheck="false"
                   [ngModel]="endDate.format('h:mm A')" (ngModelChange)="setEndTime($event)" *ngIf="includeTime"
                   (blur)="handleTimeChange(endTime, endDate, 'end')"
                   (keyup.enter)="handleTimeChange(endTime, endDate, 'end')">
          </ng-container>
        </div>
      </div>
    </div>
  </div>

</div>

<!--- ********** TEMPLATE BODY CALENDAR (NOT RANGE)*************** -->
<ng-template #templateCalendar let-data="data" let-year="year" let-includedend="includeEndDate" let-month="month"
             let-start="startDay" let-end="endDate">
  <ng-container *ngIf="includeEndDate">
    <div *ngFor="let day of data[year][month]"
         class="calendar-date calendar-day-not-range-{{year}}-{{month}}-{{day?.value}}"
         [ngClass]="{
          'is-disabled': !day?.available,
          'calendar-range': day?.inRange,
          'calendar-range-start': day?.value === start?.value && day?.month === start?.month && day?.year === start?.year ,
          'calendar-range-end': day?.value === end?.value && day?.month === end?.month && day?.year === end?.year}">
      <button type="button" *ngIf="day.value !== 0" class="date-item"
              [ngClass]="{'is-active': day?.isActive, 'is-today': day?.isToday}" (click)="selectDay(day)">
        {{day.value}}</button>
      <button type="button" *ngIf="day?.value === 0" class="date-item"></button>
    </div>
  </ng-container>

  <ng-container *ngIf="!includeEndDate">
    <div *ngFor = "let day of data[year][month]" class="calendar-date"
         [ngClass]="{'is-disabled': !day?.available }">
      <button
        *ngIf = "day?.value !== 0"
        class="date-item"
        [ngClass]="{'is-active': day?.isActive, 'is-today': day?.isToday}"
        (click) = "selectDay(day)">{{day?.value}}</button>
      <button *ngIf = "day?.value === 0" class="date-item"></button>
    </div>
  </ng-container>
</ng-template>
